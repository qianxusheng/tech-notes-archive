# 操作系统笔记

## 基本特征
- **并行性 (Concurrency)**：并行需要硬件支持，如多核处理器，分布式计算等，并发是指宏观上一段时间内能同时运行多个程序。
- **共享 (Shared)**：资源可以被多个并发进程共享，分为互斥共享和同步共享两种。
- **虚拟性 (Virtual)**：时分复用：进程每次占用一个CPU时间片，快速切换；空分复用：通过页表管理虚拟内存和物理内存的映射，虚拟内存的每个进程都有独立地址空间，通过页面置换算法加载不在当前物理内存上的虚拟页。
- **异步 (Asynchronous)**：异步操作指不阻塞当前线程的执行，允许任务并行处理。

## 基本功能
- **进程管理 (Process)**
- **内存管理 (Memory)**
- **文件管理 (Document)**
- **设备管理 (Device)**

## 操作系统架构
- **宏内核 (Monolithic Kernel)**：高性能，各模块共享资源。
- **微内核 (Microkernel)**：部分操作系统功能移出内核，拆分为若干相互独立的服务。

## 中断分类
- **外部中断 (External Interrupt)**：外部触发。
- **异常 (Exception)**：CPU指令异常。
- **陷阱 (Trap)**：用户程序中使用系统调用，控制权转换，`user mode -> kernel mode`。

---

## 进程管理

### 进程和线程
- **进程**：资源分配的基本单位，切换创建删除的开销大，进程通信需要借助 `inter-process communication`。
- **线程**：独立调度的基本单位，可以共享进程资源，可以通过直接读写同一进程中的内存数据进行通信。
  - 同一进程的线程切换不会引起进程切换，不同进程的线程切换会引起进程切换。

### 进程状态切换
- **进程状态**：`ready`, `running`, `waiting` 三种状态。
  - **ready 和 running** 双向转换。
  - **ready 状态** 下通过调度算法获得 CPU 时间，转为 running，结束后返回 ready。
  - **running** 时发生阻塞进入 **waiting**（如果缺少 running 资源）。

### 进程调度算法
- **批处理系统**：`first-come first-served`, `shortest job first`, `shortest remaining time next`。
- **交互式系统**：`time slice rotation`, `priority dispatch`, `multi-level feedback queue`。
- **实时系统**：软实时和硬实时，一个请求在确定时间内需要得到响应，软实时允许一定容忍时间。

### 进程同步
- **临界区**：对临界资源进行访问的代码区域，要求互斥访问。
- **同步与互斥**：多个进程因为合作关系产生的先后执行关系；互斥，一种简单的同步。
- **信号量**：控制资源能被多少个进程使用，常见操作有申请 `P` 和释放 `V`，常见信号量有二元 `binary` 和计数 `count`。
- **管程 (Monitor)**：封装锁和变量条件，用于管理同步。
- **锁**：基础互斥工具，进入临界区上锁，退出解锁。
- **总结**：临界区用锁保护，锁控制执行先后，信号量控制资源数量（实现进程同步）；管程封装锁和变量条件（易于使用）。

### 进程通信
- **Pipe**：管道通信。
- **Named Pipe**：命名管道。
- **Message Queue**：消息队列。
- **信号量**：计数器，为多个进程提供共享数据对象的访问。
- **共享内存 (Shared Memory)**：多个进程共享给定存储区，实现通信。
- **WebSocket**：WebSocket 用于进程之间的实时双向通信。

---

## 内存管理

### 虚拟内存
- **虚拟内存**：实现多进程，将物理内存 (RAM) 扩展成更大的逻辑内存，暂时不用的部分放在硬盘的交换区。

### 分页系统地址映射
- **内存管理单元 (MMU)**：负责地址空间和物理内存的转换。
- **页表 (Page Table)**：存储页和页框的映射。
  - 虚拟地址分为 `页号` (page number) 和 `偏移量` (page offset) 两部分，用 `page number` 查找 `page table`，`page frame` 的起始地址 + `page offset` 就是实际的物理地址。

### 页面置换算法
- **LRU**：最少使用。
- **FIFO**：先进先出。

---

## 设备管理

### 设备管理
- **设备抽象**：屏蔽底层细节，提供简洁一致的接口。
- **设备共享**：多个进程共享设备。

### 常见设备
- 输入设备：鼠标、键盘。
- 输出设备：显示器、打印机。
- 存储设备：HDD、SSD、光盘。
- 通信设备：网卡。

### 硬盘
- **磁盘结构**：盘面 (platter), 磁道 (track), 扇区 (sector), 磁头 (head), 主轴 (spindle), 手臂 (actuator arm)。
- **磁盘调度**：优化磁头的运动方式。

### 设备驱动程序
- **设备驱动程序**：操作系统与硬件设备的接口，负责控制和管理硬件。
  - 内核模式：可直接访问硬件。
  - 用户模式：无法直接访问硬件，通过系统调用与操作系统库函数交互。

### 设备调度
- **调度算法**：分配设备给各个进程。

### 设备并发控制
- **同步机制**：管理多个进程请求同一设备时，确保互斥访问。

### 设备故障处理
- **故障检测与恢复**：通过容错机制处理设备故障。

---

## 文件管理

### 文件
- 普通文件、文件列表（文件夹）、设备文件（抽象成文件）。

### 文件属性
- 文件名、文件大小、创建/修改时间、访问权限、所属用户/组、文件类型。

### 文件操作
- 读写、创建删除、打开关闭、修改权限名字等。

### 文件系统
- 管理磁盘空间，决定文件如何存储和检索。

---

## 链接（Linking）

### C/C++
- **预处理 (Preprocessing)** -> **编译 (Compiling)** -> **汇编 (Assembling)** -> **链接 (Linking)**。

### 静态链接与动态链接
- **静态链接**：将符号定义与内存位置关联，修改所有符号引用。
- **动态链接**：共享库不会复制到可执行文件中，减少资源浪费。

### Java
- **编译成字节码**，通过 **JVM** 加载并生成平台特定的机器码。

### Python
- **解释执行**，通过 **PVM** 将字节码转换成机器码并执行。

---
